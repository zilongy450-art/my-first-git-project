{"name": "test_api_case[1 - 地址模块-添加地址接口-正向-传入完整合法参数返回地址添加成功]", "status": "broken", "statusDetails": {"message": "AttributeError: 'NoneType' object has no attribute 'status_code'", "trace": "self = <testcases.test_api_excel_driver.TestAllDrivers object at 0x00000219D8EB2090>\ncase = {'body': '{\\n  \"username\": \"test\",\\n  \"name\": \"张三\",\\n  \"phone\": \"13800138000\",\\n  \"province\": \"广东省\",\\n  \"city\": \"深圳市\",...: '1', 'case_name': '地址模块-添加地址接口-正向-传入完整合法参数返回地址添加成功', 'expected_content': '\"success\": true, \"message\": \"地址添加成功\"', ...}\nrequest_handler = <core.request_handler.RequestHandler object at 0x00000219D8CABD40>\n\n    @allure.story(\"Excel测试用例执行\")\n    @pytest.mark.parametrize(\"case\", all_test_cases, ids=test_case_ids)\n    def test_api_case(self, case, request_handler):\n        \"\"\"\n        利用执行器执行用例\n    \n        Args:\n            case (dict): 测试用例数据\n            request_handler: 请求处理器fixture\n        \"\"\"\n        self.assert_handler = AssertHandler()\n        # 创建测试执行器实例\n        self.test_executor = TestExecutor(request_handler, data_handler, self.assert_handler)\n>       self.test_executor.execute_test_case(case)\n\ntestcases\\test_api_excel_driver.py:78: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ncore\\test_executor.py:33: in execute_test_case\n    return self._execute_case_logic(case)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <core.test_executor.TestExecutor object at 0x00000219D8EF85C0>\ncase = {'body': '{\\n  \"username\": \"test\",\\n  \"name\": \"张三\",\\n  \"phone\": \"13800138000\",\\n  \"province\": \"广东省\",\\n  \"city\": \"深圳市\",...: '1', 'case_name': '地址模块-添加地址接口-正向-传入完整合法参数返回地址添加成功', 'expected_content': '\"success\": true, \"message\": \"地址添加成功\"', ...}\n\n    def _execute_case_logic(self, case):\n        \"\"\"\n        实际执行测试用例的逻辑\n    \n        Args:\n            case (dict): 测试用例数据\n        \"\"\"\n        # 替换请求中的变量\n        logger.debug(\"开始处理请求参数中的变量替换\")\n        url = self.data_handler.replace_variables(case['url'])\n    \n        # 安全地解析JSON字段\n        headers_str = self.data_handler.replace_variables(case['headers'])\n        params_str = self.data_handler.replace_variables(case['params'])\n        body_str = self.data_handler.replace_variables(case['body'])\n    \n        headers = {}\n        params = {}\n        body = {}\n    \n        if headers_str and headers_str.strip():\n            try:\n                headers = json.loads(headers_str)\n            except json.JSONDecodeError as e:\n                logger.warning(f\"headers JSON解析失败: {e}, 使用空字典\")\n    \n        # 获取Content-Type\n        content_type = headers.get('Content-Type', '').lower() if isinstance(headers, dict) else ''\n    \n        if params_str and params_str.strip():\n            try:\n                params = json.loads(params_str)\n            except json.JSONDecodeError as e:\n                logger.warning(f\"params JSON解析失败: {e}, 使用空字典\")\n    \n        if body_str and body_str.strip():\n            # 根据Content-Type判断是否需要解析JSON\n            if 'text/plain' in content_type:\n                # text/plain类型，body作为纯文本处理\n                body = body_str\n                logger.debug(\"Content-Type为text/plain，body作为纯文本处理\")\n            elif 'application/x-www-form-urlencoded' in content_type:\n                # form类型，body作为字符串处理\n                body = body_str\n                logger.debug(\"Content-Type为application/x-www-form-urlencoded，body作为字符串处理\")\n            else:\n                # 默认或其他类型，尝试解析为JSON\n                try:\n                    body = json.loads(body_str)\n                except json.JSONDecodeError as e:\n                    logger.warning(f\"body JSON解析失败: {e}, 使用空字典\")\n    \n        logger.debug(\"请求参数变量替换完成\")\n    \n        # 发送请求\n        logger.info(f\"发送 {case['method']} 请求到 {url}\")\n        # 根据Content-Type决定使用哪个参数发送body\n        if 'text/plain' in content_type and isinstance(body, str):\n            response = self.request_handler.send_request(\n                method=case['method'],\n                url=url,\n                headers=headers,\n                params=params,\n                plain_text=body\n            )\n        else:\n            response = self.request_handler.send_request(\n                method=case['method'],\n                url=url,\n                headers=headers,\n                params=params,\n                json_data=body\n            )\n    \n        # 断言状态码内容\n        if case['expected_status']:\n>           logger.info(f\"执行状态码断言: 期望 {case['expected_status']} 实际 {response.status_code}\")\n                                                                    ^^^^^^^^^^^^^^^^^^^^\nE           AttributeError: 'NoneType' object has no attribute 'status_code'\n\ncore\\test_executor.py:113: AttributeError"}, "description": "\n        利用执行器执行用例\n\n        Args:\n            case (dict): 测试用例数据\n            request_handler: 请求处理器fixture\n        ", "steps": [{"name": "执行用例: 1 - 地址模块-添加地址接口-正向-传入完整合法参数返回地址添加成功", "status": "broken", "statusDetails": {"message": "AttributeError: 'NoneType' object has no attribute 'status_code'\n", "trace": "  File \"C:\\Users\\Lenovo\\Desktop\\ifrit-apitest-master\\core\\test_executor.py\", line 33, in execute_test_case\n    return self._execute_case_logic(case)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Lenovo\\Desktop\\ifrit-apitest-master\\core\\test_executor.py\", line 113, in _execute_case_logic\n    logger.info(f\"执行状态码断言: 期望 {case['expected_status']} 实际 {response.status_code}\")\n                                                                       ^^^^^^^^^^^^^^^^^^^^\n"}, "attachments": [{"name": "Curl命令", "source": "6a3f1031-3a96-4388-abd1-a2879e4ebf5c-attachment.txt", "type": "text/plain"}, {"name": "请求URL", "source": "13e0875e-6a8e-4f24-ab4f-a89c3ce079ee-attachment.txt", "type": "text/plain"}, {"name": "请求头", "source": "2ae40ffe-a090-421d-a48e-6940afd1f989-attachment.json", "type": "application/json"}, {"name": "请求JSON数据", "source": "d4e749f9-eee0-4283-bbc8-f600c842e2ac-attachment.json", "type": "application/json"}, {"name": "请求异常", "source": "6a8df714-f9b2-429a-bfb9-b71e7c645f94-attachment.txt", "type": "text/plain"}], "start": 1764899140099, "stop": 1764899155041}], "attachments": [{"name": "log", "source": "70dda7c5-9e3c-4e93-9989-62d220dfed57-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "case", "value": "{'case_id': '1', 'case_name': '地址模块-添加地址接口-正向-传入完整合法参数返回地址添加成功', 'method': 'POST', 'url': '/api/address/add', 'headers': '{\\n  \"Authorization\": \"Bearer 4AB527C4318B39FB74B4BA1ABBCC226B\",\\n  \"Content-Type\": \"application/json\"\\n}\\n', 'params': '', 'body': '{\\n  \"username\": \"test\",\\n  \"name\": \"张三\",\\n  \"phone\": \"13800138000\",\\n  \"province\": \"广东省\",\\n  \"city\": \"深圳市\",\\n  \"district\": \"南山区\",\\n  \"detail\": \"科技园路1号\",\\n  \"is_default\": 1\\n}\\n', 'expected_status': '201', 'expected_content': '\"success\": true, \"message\": \"地址添加成功\"', 'json_path': '', 'expected_json_value': '', 'extract_key': 'address_id1=json.address_id', 'save_var_name': '', 'validate': ''}"}], "start": 1764899140098, "stop": 1764899155043, "uuid": "226fe596-e4ed-4e04-9a68-b13e3906d509", "historyId": "e44cb39d743c5d36f1bcb9c2ea93c9a8", "testCaseId": "cac94d7f12afcd73e6b26c95a7dd3252", "fullName": "testcases.test_api_excel_driver.TestAllDrivers#test_api_case", "labels": [{"name": "story", "value": "Excel测试用例执行"}, {"name": "feature", "value": "API接口测试"}, {"name": "parentSuite", "value": "testcases"}, {"name": "suite", "value": "test_api_excel_driver"}, {"name": "subSuite", "value": "TestAllDrivers"}, {"name": "host", "value": "DESKTOP-A7LNAG5"}, {"name": "thread", "value": "19180-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "testcases.test_api_excel_driver"}], "titlePath": ["testcases", "test_api_excel_driver.py", "TestAllDrivers"]}